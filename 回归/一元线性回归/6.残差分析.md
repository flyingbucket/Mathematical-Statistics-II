## 残差分析：判断真实模型是否为线性模型

 若为线性模型则必满足 $Ee_i = Ex_i \cdot e_i = 0$

残差应在 0 附近随机波动

 残差 $e_i$ 的方差

$$
\begin{aligned}
Var(e_i) &= Var(y_i - \hat{y}_i) \\
&= Var(y_i) + Var(\hat{y}_i) - 2Cov(y_i, \hat{y}_i)
\end{aligned}
$$

(1) $$Var(y_i) = \sigma^2$$

(2) 
$$
\begin{aligned}
Var(\hat{y}_i) &= Var(\hat{\beta}_0 + \hat{\beta}_1 x_i) \\
&= Var(\hat{\beta}_0) + Var(\hat{\beta}_1 x_i) + 2Cov(\hat{\beta}_0, \hat{\beta}_1 x_i) \\
\end{aligned}
$$

其中
$$
\begin{aligned}
Var(\hat{\beta}_0) &= \left(\frac{1}{n} + \frac{\bar{x}^2}{L_{xx}}\right)\sigma^2 \\
\\
Var(\hat{\beta}_1 x_i) &= x_i^2 \frac{\sigma^2}{L_{xx}}\\
\\
Cov(\hat{\beta}_0, \hat{\beta}_1) &= Cov(\bar{y} - \hat{\beta}_1 \bar{x}, \hat{\beta}_1) \\
&= Cov(-\hat{\beta}_1 \bar{x}, \hat{\beta}_1) + Cov(\bar{y}, \hat{\beta}_1) \\
&= -\bar{x} Var(\hat{\beta}_1) + \frac{Var(y_i)}{n \sum (x_i - \bar{x})^2} \cdot \sum (x_i - \bar{x}) \\
&= -\bar{x} \frac{\sigma^2}{L_{xx}} + 0 \\
\end{aligned}
$$
故$Cov(\hat{\beta}_0, \hat{\beta}_1 x_i) = -\bar{x} x_i \frac{\sigma^2}{L_{xx}}$
故
$$
\begin{aligned}
Var(\hat{y}_i) &= \left(\frac{1}{n} + \frac{\bar{x}^2}{L_{xx}}\right)\sigma^2 + x_i^2 \frac{\sigma^2}{L_{xx}} - 2\bar{x} x_i \frac{\sigma^2}{L_{xx}} \\
&= \left(\frac{1}{n} + \frac{(x_i - \bar{x})^2}{L_{xx}}\right)\sigma^2
\end{aligned}
$$

(3) 

$$
\begin{aligned}
Cov(y_i, \hat{y}_i) &= Cov(y_i, \hat{\beta}_1 x_i + \bar{y} - \hat{\beta}_1 \bar{x})\\
&= Cov(y_i, \hat{\beta}_1 x_i) + (x_i - \bar{x}) Cov(y_i, \hat{\beta}_1) \\
&= \frac{1}{n} Var(y_i) + (x_i - \bar{x}) Cov(y_i, \frac{\sum (x_i - \bar{x}) y_i}{L_{xx}}) \\
&= \frac{1}{n} Var(y_i) + \frac{(x_i - \bar{x})^2}{L_{xx}} Var(y_i) \\
&= \left(\frac{1}{n} + \frac{(x_i - \bar{x})^2}{L_{xx}}\right)\sigma^2
\end{aligned}
$$

综上：$Var(e_i) = \sigma^2 + \left(\frac{1}{n} + \frac{(x_i - \bar{x})^2}{L_{xx}}\right)\sigma^2 - 2\left(\frac{1}{n} + \frac{(x_i - \bar{x})^2}{L_{xx}}\right)\sigma^2 = (1 - \frac{1}{n} - \frac{(x_i - \bar{x})^2}{L_{xx}})\sigma^2 = (1 - \hat{h}_i)\sigma^2$